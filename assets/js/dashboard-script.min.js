bulkmail=function(e,t,a,n){"use strict";var i=t(n.body).hasClass("mobile"),s=t(n.body).hasClass("index-php"),o=t(".postbox .handlediv"),r=t(".bulkmail-mb-subscribers"),l=t("#bulkmail-subscriber-range"),c=t("#subscriber-chart-wrap"),d=t("#subscriber-chart"),u,h,f={responsive:false,legend:false,animationEasing:"easeOutExpo",maintainAspectRatio:false,tooltips:{backgroundColor:"rgba(56,56,56,0.9)",displayColors:false,cornerRadius:2,caretSize:8,callbacks:{label:function(t,a){return e.util.sprintf(e.l10n.dashboard.subscribers,y(t.yLabel))}}},scales:{xAxes:[{ticks:{maxTicksLimit:20},_type:"time",_time:{format:"MM/DD/YYYY HH:mm",round:"day",tooltipFormat:"ll HH:mm"}}],yAxes:[{ticks:{callback:function(e){return _(e,true)}}}]}};if(d.length){h=d[0].getContext("2d")}l.on("change",function(){g()}).trigger("change");if(!s){t(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:i?200:0,distance:2,tolerance:"pointer",forcePlaceholderSize:true,helper:function(e,t){return t.clone().find(":input").attr("name",function(e,t){return"sort_"+parseInt(Math.random()*1e5,10).toString()+"_"+t}).end()},opacity:.65,update:function(e,t){k()}});t(".postbox .handlediv").each(function(){var e=t(this);e.attr("aria-expanded",!e.parent(".postbox").hasClass("closed"))}).on("click",function(){var e=t(this);e.parent(".postbox").toggleClass("closed");e.attr("aria-expanded",!e.parent(".postbox").hasClass("closed"))})}t(n).on("verified.bulkmail",function(e,a,n,i){t(".bulkmail-purchasecode").html(a);t(".bulkmail-username").html(n);t(".bulkmail-email").html(i);t("#bulkmail-mb-bulkmail").addClass("verified");t("#bulkmail-register-panel").delay(2500).fadeTo(400,0,function(){t("#bulkmail-register-panel").slideUp(400)})}).on("click",".order-lower-indicator",function(){var e=t(this).closest(".postbox"),a=e.next();if(a.length){e.insertAfter(a)}k()}).on("click",".order-higher-indicator",function(){var e=t(this).closest(".postbox"),a=e.prev();if(a.length){e.insertBefore(a)}k()}).on("click",".toggle-indicator",function(){t(this).closest(".postbox").toggleClass("closed");C()}).on("click",".hide-postbox-tog",function(){t("#"+t(this).val())[t(this).is(":checked")?"show":"hide"]().removeClass("closed");C()}).on("click",".locked",function(){t(".purchasecode").focus().select()}).on("click",".check-for-update",function(){var a=t(this);a.html(e.l10n.dashboard.checking);e.util.ajax("check_for_update",function(n){a.html(e.l10n.dashboard.check_again);if(n.success){a.closest(".postbox")[n.update?"addClass":"removeClass"]("has-update");t(".update-version").html(n.version);t(".update-last-check").html(n.last_update)}});return false}).one("click",".load-language",function(){var a=t(this);a.html(e.l10n.dashboard.downloading);e.util.ajax("load_language",function(t){if(t.success){a.html(e.l10n.dashboard.reload_page)}});return false}).on("click",".reset-license",function(){if(!confirm(e.l10n.dashboard.reset_license)){return false}});var p=function(a){if(!a){return}var i,s=t(".bulkmail-mb-"+a),o=s.find(".bulkmail-mb-select"),r=s.find(".bulkmail-mb-label"),l=s.find(".bulkmail-mb-link"),c=l.attr("href");if(!o.length){return}o.on("change",function(){d(t(this).val())}).trigger("change");t(n).on("heartbeat-tick",function(e,t){if(i){d(i,true)}});s.find(".piechart").easyPieChart({animate:1e3,rotate:180,barColor:e.colors.main,trackColor:e.colors.track,lineWidth:9,size:75,lineCap:"butt",onStep:function(e){this.$el.find("span").text(Math.round(e))},onStop:function(e){this.$el.find("span").text(Math.round(e))}});function d(t,n){if(!n){s.addClass("bulkmail-loading")}e.util.ajax("get_dashboard_data",{type:a,id:t},function(e){var t=e.data;l.html(t.name).removeAttr("class").addClass("bulkmail-mb-link").attr("href",c.replace("%d",t.ID));if(t.status){l.addClass("status-"+t.status)}s.find(".stats-total").html(t.sent_formatted);s.find(".stats-open").data("easyPieChart").update(t.openrate*100);s.find(".stats-clicks").data("easyPieChart").update(t.clickrate*100);s.find(".stats-unsubscribes").data("easyPieChart").update(t.unsubscriberate*100);s.find(".stats-bounces").data("easyPieChart").update(t.bouncerate*100);i=t.ID;s.removeClass("bulkmail-loading")})}};var m=new p("campaigns");var b=new p("lists");function g(t,a,n,i){r.addClass("bulkmail-loading");e.util.ajax("get_dashboard_chart",{range:l.val()},function(e){v();r.removeClass("bulkmail-loading");if(!u){u=new Chart(h,{type:"line",data:e.chart,options:f})}})}function v(){u=null;if(d){d.remove()}d=t("<canvas>").prependTo(c);h=d[0].getContext("2d");d.attr({width:c.width(),height:c.height()})}function x(){k();C()}function k(){var e={};t.each(t(".postbox-container"),function(){var a=t(this).data("id");t.each(t(this).find(".postbox"),function(){if(!e[a]){e[a]=[]}e[a].push(this.id)});if(e[a]){e[a]=e[a].join(",")}});var a={action:"meta-box-order",_ajax_nonce:t("#meta-box-order-nonce").val(),page:"newsletter_page_bulkmail_dashboard",order:e};t.post(ajaxurl,a)}function C(){var e=t(".postbox:hidden").map(function(){return this.id}).toArray(),a=t(".postbox.closed").map(function(){return this.id}).toArray();var n={action:"closed-postboxes",closedpostboxesnonce:t("#closedpostboxesnonce").val(),closed:a.length?a.join(","):"",hidden:e.length?e.join(","):"",page:"newsletter_page_bulkmail_dashboard"};t.post(ajaxurl,n)}function _(e,t){if(e>=1e6){return(e/1e3).toFixed(1)+"M"}else if(e>=1e3&&!t){return(e/1e3).toFixed(1)+"K"}return!(e%1)?y(e):""}function y(e,t,a,n){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var i=!isFinite(+e)?0:+e;var s=!isFinite(+t)?0:Math.abs(t);var o=typeof n==="undefined"?",":n;var r=typeof a==="undefined"?".":a;var l="";var c=function(e,t){var a=Math.pow(10,t);return""+(Math.round(e*a)/a).toFixed(t)};l=(s?c(i,s):""+Math.round(i)).split(".");if(l[0].length>3){l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,o)}if((l[1]||"").length<s){l[1]=l[1]||"";l[1]+=new Array(s-l[1].length+1).join("0")}return l.join(r)}return e}(bulkmail||{},jQuery,window,document);